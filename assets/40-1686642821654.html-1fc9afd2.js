import{_ as n,o as a,c as s,f as t}from"./app-19e0b0f0.js";const e={},p=t(`<h1 id="流控配置" tabindex="-1"><a class="header-anchor" href="#流控配置" aria-hidden="true">#</a> 流控配置</h1><h2 id="流控添加与测试" tabindex="-1"><a class="header-anchor" href="#流控添加与测试" aria-hidden="true">#</a> 流控添加与测试</h2><h3 id="添加流控" tabindex="-1"><a class="header-anchor" href="#添加流控" aria-hidden="true">#</a> 添加流控</h3><p>在Sentinel控制台中，对请求添加流控配置</p><p>添加流控的方式有两种</p><ul><li>方式一：直接添加流控规则</li></ul><figure><img src="https://jihulab.com/byzh123/images/-/raw/images/pictures/2023/06/13_15_31_35_image-20230613153135471.png" alt="image-20230613153135471" tabindex="0" loading="lazy"><figcaption>image-20230613153135471</figcaption></figure><ul><li>方式二：找到特定请求后添加流控规则</li></ul><figure><img src="https://jihulab.com/byzh123/images/-/raw/images/pictures/2023/06/13_15_32_49_image-20230613153249081.png" alt="image-20230613153249081" tabindex="0" loading="lazy"><figcaption>image-20230613153249081</figcaption></figure><div class="hint-container warning"><p class="hint-container-title">注意</p><p>此时，流控配置信息是保存在内存中的，重启服务时便会失效。</p><p>后续需要配置Sentinel的数据源信息</p></div><h3 id="访问测试" tabindex="-1"><a class="header-anchor" href="#访问测试" aria-hidden="true">#</a> 访问测试</h3><p>再次通过浏览器访问该请求，查看结果</p><p>当正常访问时，服务器正常返回响应结果</p><figure><img src="https://jihulab.com/byzh123/images/-/raw/images/pictures/2023/06/13_15_36_14_image-20230613153614060.png" alt="正常访问 结果" tabindex="0" loading="lazy"><figcaption>正常访问 结果</figcaption></figure><p>当超过了流控规则后，会自动被Sentinel拦截，并返回<code>Blocked by Sentinel (flow limiting)</code>错误信息</p><figure><img src="https://jihulab.com/byzh123/images/-/raw/images/pictures/2023/06/13_15_54_46_13_15_35_7_image-20230613153507650.png" alt="流控拦截 结果" tabindex="0" loading="lazy"><figcaption>流控拦截 结果</figcaption></figure><h2 id="自定义流控返回信息" tabindex="-1"><a class="header-anchor" href="#自定义流控返回信息" aria-hidden="true">#</a> 自定义流控返回信息</h2><p>编写自定义Sentinel配置类，在配置类构造方法中配置自定义响应</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SentinelConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">SentinelConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WebCallbackManager</span><span class="token punctuation">.</span><span class="token function">setUrlBlockHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UrlBlockHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">blocked</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnum</span><span class="token punctuation">.</span><span class="token constant">TO_MANY_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>浏览器访问测试</p><figure><img src="https://jihulab.com/byzh123/images/-/raw/images/pictures/2023/06/13_15_51_58_image-20230613155158062.png" alt="image-20230613155158062" tabindex="0" loading="lazy"><figcaption>image-20230613155158062</figcaption></figure>`,21),i=[p];function c(o,l){return a(),s("div",null,i)}const r=n(e,[["render",c],["__file","40-1686642821654.html.vue"]]);export{r as default};
